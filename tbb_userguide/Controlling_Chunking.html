
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Controlling Chunking &#8212; oneAPI Threading Building Blocks (oneTBB)  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="../_static/custom.js"></script>
    <link rel="shortcut icon" href="../_static/favicons.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bandwidth and Cache Affinity" href="Bandwidth_and_Cache_Affinity.html" />
    <link rel="prev" title="Automatic Chunking" href="Automatic_Chunking.html" />
    <script defer type="text/javascript" src="https://www.intel.com/content/dam/www/global/wap/performance-config.js" ></script>
    <script type="text/javascript">
        // Configure TMS settings
        var wapLocalCode = 'us-en'; // Dynamically set per localized site, see mapping table for values
        var wapSection = "oneapi-tbb"; // WAP team will give you a unique section for your site
        // Load TMS
        (function () {
          var url = 'https://www.intel.com/content/dam/www/global/wap/tms-loader.js'; // WAP file URL
          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true; po.src = url;
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
      </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/oneAPI-rgb-rev-100.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">oneAPI Threading Building Blocks (oneTBB)  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/help_support.html">
   Getting Help and Support
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/notation.html">
   Notational Conventions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/Benefits.html">
   oneTBB Benefits
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="title.html">
   oneTBB Developer Guide
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Package_Contents.html">
     Package Contents
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Debug_Versus_Release_Libraries.html">
       Debug Versus Release Libraries
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Scalable_Memory_Allocator.html">
       Scalable Memory Allocator
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Windows_OS_ug.html">
       Windows*
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Linux_OS.html">
       Linux*
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Mac_OS.html">
       macOS*
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="Parallelizing_Simple_Loops.html">
     Parallelizing Simple Loops
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="Initializing_and_Terminating_the_Library.html">
       Initializing and Terminating the Library
      </a>
     </li>
     <li class="toctree-l3 current active has-children">
      <a class="reference internal" href="parallel_for.html">
       parallel_for
      </a>
      <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul class="current">
       <li class="toctree-l4">
        <a class="reference internal" href="Lambda_Expressions.html">
         Lambda Expressions
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Automatic_Chunking.html">
         Automatic Chunking
        </a>
       </li>
       <li class="toctree-l4 current active">
        <a class="current reference internal" href="#">
         Controlling Chunking
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Bandwidth_and_Cache_Affinity.html">
         Bandwidth and Cache Affinity
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Partitioner_Summary.html">
         Partitioner Summary
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="parallel_reduce.html">
       parallel_reduce
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Advanced_Example.html">
       Advanced Example
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Advanced_Topic_Other_Kinds_of_Iteration_Spaces.html">
       Advanced Topic: Other Kinds of Iteration Spaces
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Parallelizing_Complex_Loops.html">
     Parallelizing Complex Loops
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Cook_Until_Done_parallel_do.html">
       Cook Until Done: parallel_for_each
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="Working_on_the_Assembly_Line_pipeline.html">
       Working on the Assembly Line: parallel_pipeline
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
      <label for="toctree-checkbox-6">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="Using_Circular_Buffers.html">
         Using Circular Buffers
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Throughput_of_pipeline.html">
         Throughput of pipeline
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Non-Linear_Pipelines.html">
         Non-Linear Pipelines
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Summary_of_Loops_and_Pipelines.html">
       Summary of Loops and Pipelines
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Flow_Graph.html">
     Parallelizing Data Flow and Dependence Graphs
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Parallelizing_Flow_Graph.html">
       Parallelizing Data Flow and Dependency Graphs
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="Basic_Flow_Graph_concepts.html">
       Basic Flow Graph Concepts
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="Graph_Object.html">
         Flow Graph Basics: Graph Object
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Nodes.html">
         Flow Graph Basics: Nodes
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Edges.html">
         Flow Graph Basics: Edges
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Mapping_Nodes2Tasks.html">
         Flow Graph Basics: Mapping Nodes to Tasks
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Flow_Graph_Message_Passing_Protocol.html">
         Flow Graph Basics: Message Passing Protocol
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Flow_Graph_Single_Vs_Broadcast.html">
         Flow Graph Basics: Single-push vs. Broadcast-push
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Flow_Graph_Buffering_in_Nodes.html">
         Flow Graph Basics: Buffering and Forwarding
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Flow_Graph_Reservation.html">
         Flow Graph Basics: Reservation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="Graph_Main_Categories.html">
       Graph Application Categories
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="Data_Flow_Graph.html">
         Data Flow Graph
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Dependence_Graph.html">
         Dependence Graph
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Predefined_Node_Types.html">
       Predefined Node Types
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="Flow_Graph_Tips.html">
       Flow Graph Tips and Tricks
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="Flow_Graph_waiting_tips.html">
         Flow Graph Tips for Waiting for and Destroying a Flow Graph
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Flow_Graph_making_edges_tips.html">
         Flow Graph Tips on Making Edges
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Flow_Graph_nested_parallelism_tips.html">
         Flow Graph Tips on Nested Parallelism
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Flow_Graph_resource_tips.html">
         Flow Graph Tips for Limiting Resource Consumption
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Flow_Graph_exception_tips.html">
         Flow Graph Tips for Exception Handling and Cancellation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="estimate_flow_graph_performance.html">
       Estimating Flow Graph Performance
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="work_isolation.html">
     Work Isolation
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Exceptions_and_Cancellation.html">
     Exceptions and Cancellation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Cancellation_Without_An_Exception.html">
       Cancellation Without An Exception
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Cancellation_and_Nested_Parallelism.html">
       Cancellation and Nested Parallelism
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Containers.html">
     Containers
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="concurrent_hash_map.html">
       concurrent_hash_map
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
      <label for="toctree-checkbox-13">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="More_on_HashCompare.html">
         More on HashCompare
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="concurrent_vector_ug.html">
       concurrent_vector
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="Concurrent_Queue_Classes.html">
       Concurrent Queue Classes
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
      <label for="toctree-checkbox-14">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="Iterating_Over_a_Concurrent_Queue_for_Debugging.html">
         Iterating Over a Concurrent Queue for Debugging
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="When_Not_to_Use_Queues.html">
         When Not to Use Queues
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Summary_of_Containers.html">
       Summary of Containers
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Mutual_Exclusion.html">
     Mutual Exclusion
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Mutex_Flavors.html">
       Mutex Flavors
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Reader_Writer_Mutexes.html">
       Reader Writer Mutexes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="UpgradeDowngrade.html">
       Upgrade/Downgrade
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Lock_Pathologies.html">
       Lock Pathologies
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Timing.html">
     Timing
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Memory_Allocation.html">
     Memory Allocation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Which_Dynamic_Libraries_to_Use.html">
       Which Dynamic Libraries to Use
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Allocator_Configuration.html">
       Configuring the Memory Allocator
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="Automically_Replacing_malloc.html">
       Automatically Replacing
       <code class="docutils literal notranslate">
        <span class="pre">
         malloc
        </span>
       </code>
       and Other C/C++ Functions for Dynamic Memory Allocation
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
      <label for="toctree-checkbox-17">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="Windows_C_Dynamic_Memory_Interface_Replacement.html">
         Windows* OS C/C++ Dynamic Memory Interface Replacement
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="Linux_C_Dynamic_Memory_Interface_Replacement.html">
         Linux* OS C/C++ Dynamic Memory Interface Replacement
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="The_Task_Scheduler.html">
     The Task Scheduler
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Task-Based_Programming.html">
       Task-Based Programming
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="When_Task-Based_Programming_Is_Inappropriate.html">
       When Task-Based Programming Is Inappropriate
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Task_Scheduler_Summary.html">
       Task Scheduler Summary
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Guiding_Task_Scheduler_Execution.html">
       Guiding Task Scheduler Execution
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="design_patterns/Design_Patterns.html">
     Design Patterns
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Agglomeration.html">
       Agglomeration
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Elementwise.html">
       Elementwise
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Odd-Even_Communication.html">
       Odd-Even Communication
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Wavefront.html">
       Wavefront
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Reduction.html">
       Reduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Divide_and_Conquer.html">
       Divide and Conquer
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/GUI_Thread.html">
       GUI Thread
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Non-Preemptive_Priorities.html">
       Non-Preemptive Priorities
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Local_Serializer.html">
       Local Serializer
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Fenced_Data_Transfer.html">
       Fenced Data Transfer
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/Reference_Counting.html">
       Reference Counting
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="design_patterns/General_References.html">
       General References
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Migration_Guide.html">
     Migrating from Threading Building Blocks (TBB)
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
    <label for="toctree-checkbox-20">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Migration_Guide/Task_Scheduler_Init.html">
       Migrating from tbb::task_scheduler_init
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Migration_Guide/Task_API.html">
       Migrating from low-level task API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Migration_Guide/Mixing_Two_Runtimes.html">
       Mixing two runtimes
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Constraints.html">
     Constrained APIs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="appendix_A.html">
     Appendix A Costs of Time Slicing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="appendix_B.html">
     Appendix B Mixing With Other Threading Packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="References.html">
     References
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../reference/reference.html">
   oneTBB API Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/info_namespace.html">
     oneapi::tbb::info namespace
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/parallel_for_each_semantics.html">
     parallel_for_each Body semantics and requirements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/type_specified_message_keys.html">
     Type-specified message keys for join_node
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/blocking_terminate.html">
     task_scheduler_handle Class
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../reference/scalable_memory_pools.html">
     Scalable Memory Pools
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
    <label for="toctree-checkbox-22">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/scalable_memory_pools/memory_pool_cls.html">
       memory_pool
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/scalable_memory_pools/fixed_pool_cls.html">
       fixed_pool
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/scalable_memory_pools/memory_pool_allocator_cls.html">
       memory_pool_allocator
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../reference/helpers_for_expressing_graphs.html">
     Helper Functions for Expressing Graphs
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
    <label for="toctree-checkbox-23">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/constructors_for_nodes.html">
       Constructors for Flow Graph nodes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/follows_and_precedes_functions.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         follows
        </span>
       </code>
       and
       <code class="docutils literal notranslate">
        <span class="pre">
         precedes
        </span>
       </code>
       function templates
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/make_node_set_function.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         make_node_set
        </span>
       </code>
       function template
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../reference/make_edges_function.html">
       <code class="docutils literal notranslate">
        <span class="pre">
         make_edges
        </span>
       </code>
       function template
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/concurrent_lru_cache_cls.html">
     concurrent_lru_cache
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/constraints_extensions.html">
     task_arena::constraints extensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/info_namespace_extensions.html">
     oneapi::tbb::info namespace extensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/task_group_extensions.html">
     task_group extensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/task_arena_extensions.html">
     task_arena extensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/this_task_arena_extensions.html">
     this_task_arena extensions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/mutex_cls.html">
     mutex
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/rw_mutex_cls.html">
     rw_mutex
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/heterogeneous_extensions_chmap.html">
     Heterogeneous overloads for
     <code class="docutils literal notranslate">
      <span class="pre">
       concurrent_hash_map
      </span>
     </code>
     member functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/custom_mutex_chmap.html">
     The customizing mutex type for
     <code class="docutils literal notranslate">
      <span class="pre">
       concurrent_hash_map
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/notices_and_disclaimers.html">
   Notices and Disclaimers
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/tbb_userguide/Controlling_Chunking.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/oneapi-src/oneTBB/issues/new?title=Issue%20on%20page%20%2Ftbb_userguide/Controlling_Chunking.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/oneapi-src/oneTBB/edit/master/doc/main/tbb_userguide/Controlling_Chunking.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="controlling-chunking">
<span id="id1"></span><h1>Controlling Chunking<a class="headerlink" href="#controlling-chunking" title="Permalink to this headline">¶</a></h1>
<p>Chunking is controlled by a <em>partitioner</em> and a <em>grainsize.</em> To gain
the most control over chunking, you specify both.</p>
<ul class="simple">
<li><p>Specify <code class="docutils literal notranslate"><span class="pre">simple_partitioner()</span></code> as the third argument to
<code class="docutils literal notranslate"><span class="pre">parallel_for</span></code>. Doing so turns off automatic chunking.</p></li>
<li><p>Specify the grainsize when constructing the range. The thread
argument form of the constructor is
<code class="docutils literal notranslate"><span class="pre">blocked_range&lt;T&gt;(begin,end,grainsize)</span></code>. The default value of
<code class="docutils literal notranslate"><span class="pre">grainsize</span></code> is 1. It is in units of loop iterations per chunk.</p></li>
</ul>
<p>If the chunks are too small, the overhead may exceed the performance
advantage.</p>
<p>The following code is the last example from parallel_for, modified to
use an explicit grainsize <code class="docutils literal notranslate"><span class="pre">G</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;oneapi/tbb.h&quot;</span><span class="cp"></span>


<span class="kt">void</span> <span class="nf">ParallelApplyFoo</span><span class="p">(</span> <span class="kt">float</span> <span class="n">a</span><span class="p">[],</span> <span class="kt">size_t</span> <span class="n">n</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">parallel_for</span><span class="p">(</span><span class="n">blocked_range</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">G</span><span class="p">),</span> <span class="n">ApplyFoo</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
                 <span class="n">simple_partitioner</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The grainsize sets a minimum threshold for parallelization. The
<code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> in the example invokes <code class="docutils literal notranslate"><span class="pre">ApplyFoo::operator()</span></code> on
chunks, possibly of different sizes. Let <em>chunksize</em> be the number of
iterations in a chunk. Using <code class="docutils literal notranslate"><span class="pre">simple_partitioner</span></code> guarantees that
[G/2] &lt;= <em>chunksize</em> &lt;= G.</p>
<p>There is also an intermediate level of control where you specify the
grainsize for the range, but use an <code class="docutils literal notranslate"><span class="pre">auto_partitioner</span></code> and
<code class="docutils literal notranslate"><span class="pre">affinity_partitioner</span></code>. An <code class="docutils literal notranslate"><span class="pre">auto_partitioner</span></code> is the default
partitioner. Both partitioners implement the automatic grainsize
heuristic described in <a class="reference internal" href="Automatic_Chunking.html#automatic-chunking"><span class="std std-ref">Automatic Chunking</span></a>. An
<code class="docutils literal notranslate"><span class="pre">affinity_partitioner</span></code> implies an additional hint, as explained later
in Section <a class="reference internal" href="Bandwidth_and_Cache_Affinity.html#bandwidth-and-cache-affinity"><span class="std std-ref">Bandwidth and Cache Affinity</span></a>. Though these partitioners
may cause chunks to have more than G iterations, they never generate
chunks with less than [G/2] iterations. Specifying a range with an
explicit grainsize may occasionally be useful to prevent these
partitioners from generating wastefully small chunks if their heuristics
fail.</p>
<p>Because of the impact of grainsize on parallel loops, it is worth
reading the following material even if you rely on <code class="docutils literal notranslate"><span class="pre">auto_partitioner</span></code>
and <code class="docutils literal notranslate"><span class="pre">affinity_partitioner</span></code> to choose the grainsize automatically.</p>
<div class="tablenoborder docutils container">
<table class="table">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><a class="reference internal" href="../_images/image002.jpg"><img alt="image0" src="../_images/image002.jpg" style="width: 161px; height: 163px;" /></a></p></th>
<th class="head"><p><a class="reference internal" href="../_images/image004.jpg"><img alt="image1" src="../_images/image004.jpg" style="width: 157px; height: 144px;" /></a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Case A</p></td>
<td><p>Case B</p></td>
</tr>
</tbody>
</table>
</div>
<p>The above figure illustrates the impact of grainsize by showing the
useful work as the gray area inside a brown border that represents
overhead. Both Case A and Case B have the same total gray area. Case A
shows how too small a grainsize leads to a relatively high proportion of
overhead. Case B shows how a large grainsize reduces this proportion, at
the cost of reducing potential parallelism. The overhead as a fraction
of useful work depends upon the grainsize, not on the number of grains.
Consider this relationship and not the total number of iterations or
number of processors when setting a grainsize.</p>
<p>A rule of thumb is that <code class="docutils literal notranslate"><span class="pre">grainsize</span></code> iterations of <code class="docutils literal notranslate"><span class="pre">operator()</span></code>
should take at least 100,000 clock cycles to execute. For example, if a
single iteration takes 100 clocks, then the <code class="docutils literal notranslate"><span class="pre">grainsize</span></code> needs to be at
least 1000 iterations. When in doubt, do the following experiment:</p>
<ol class="arabic simple">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">grainsize</span></code> parameter higher than necessary. The grainsize
is specified in units of loop iterations. If you have no idea of how
many clock cycles an iteration might take, start with
<code class="docutils literal notranslate"><span class="pre">grainsize</span></code>=100,000. The rationale is that each iteration
normally requires at least one clock per iteration. In most cases,
step 3 will guide you to a much smaller value.</p></li>
<li><p>Run your algorithm.</p></li>
<li><p>Iteratively halve the <code class="docutils literal notranslate"><span class="pre">grainsize</span></code> parameter and see how much the
algorithm slows down or speeds up as the value decreases.</p></li>
</ol>
<p>A drawback of setting a grainsize too high is that it can reduce
parallelism. For example, if the grainsize is 1000 and the loop has 2000
iterations, the <code class="docutils literal notranslate"><span class="pre">parallel_for</span></code> distributes the loop across only two
processors, even if more are available. However, if you are unsure, err
on the side of being a little too high instead of a little too low,
because too low a value hurts serial performance, which in turns hurts
parallel performance if there is other parallelism available higher up
in the call tree.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You do not have to set the grainsize too precisely.</p>
</div>
<p>The next figure shows the typical “bathtub curve” for execution time
versus grainsize, based on the floating point <code class="docutils literal notranslate"><span class="pre">a[i]=b[i]*c</span></code>
computation over a million indices. There is little work per iteration.
The times were collected on a four-socket machine with eight hardware
threads.</p>
<div class="fignone docutils container" id="fig2">
<p>Wall Clock Time Versus Grainsize
<a class="reference internal" href="../_images/image006.jpg"><img alt="image2" src="../_images/image006.jpg" style="width: 462px; height: 193px;" /></a></p>
</div>
<p>The scale is logarithmic. The downward slope on the left side indicates
that with a grainsize of one, most of the overhead is parallel
scheduling overhead, not useful work. An increase in grainsize brings a
proportional decrease in parallel overhead. Then the curve flattens out
because the parallel overhead becomes insignificant for a sufficiently
large grainsize. At the end on the right, the curve turns up because the
chunks are so large that there are fewer chunks than available hardware
threads. Notice that a grainsize over the wide range 100-100,000 works
quite well.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>A general rule of thumb for parallelizing loop nests is to
parallelize the outermost one possible. The reason is that each
iteration of an outer loop is likely to provide a bigger grain of
work than an iteration of an inner loop.</p>
</div>
<div class="admonition-product-and-performance-information admonition">
<p class="admonition-title">Product and Performance Information</p>
<p>Performance varies by use, configuration and other factors. Learn more at <a class="reference external" href="https://www.intel.com/PerformanceIndex">www.intel.com/PerformanceIndex</a>.
Notice revision #20201201</p>
</div>
</div>


              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="Automatic_Chunking.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Automatic Chunking</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="Bandwidth_and_Cache_Affinity.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Bandwidth and Cache Affinity</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Intel<br/>
        
            &copy; Copyright 2021, Intel Corporation.<br/>
          <div class="extra_footer">
            <p align="right"><a href="https://www.intel.com/content/www/us/en/privacy/intel-cookie-notice.html">Cookies</a></p>
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>